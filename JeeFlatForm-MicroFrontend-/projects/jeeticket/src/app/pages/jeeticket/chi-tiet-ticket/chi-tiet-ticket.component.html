<link rel="stylesheet" href="https://cdn.quilljs.com/1.3.6/quill.core.css">
<style>
    #filter-icon {
        background-image: url(https://cdn.jee.vn/jee-comment/icons/facebook-comment-header/filter.png);
        background-position: -17px -467px;
        background-size: auto;
        width: 16px;
        height: 16px;
        background-repeat: no-repeat;
        display: inline-block;
    }

    .title-duan {
        padding: 10px;
        cursor: pointer;
    }

    .title-duan:hover {
        background-color: #f3f6f9;
    }

    .dropdown-item {
        width: 100%;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .page-messagess::-webkit-scrollbar {
        display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .page-messagess {
        -ms-overflow-style: none;
        /* IE and Edge */
        scrollbar-width: none;
        /* Firefox */
    }



    .HienDauBaCham {
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;

        &:hover {
            -webkit-line-clamp: 5;
        }
    }

    .three-dot-content{
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        display: -webkit-box;
        font-size: 12pt;
    }
    .HienDauBaCham_Doc {
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
    }

    .title-three-dot {
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        display: -webkit-box;
    }

    .three-dot-attachment {
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .Hide-Description {
        white-space: pre-wrap;
        overflow: hidden;
        text-overflow: ellipsis;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        width: 80%;
    }
</style>
<div class="row" style="margin: 0;" [ngStyle]="{'width': getWidthDetails()}">
    <div iv [ngStyle]="{'width': getWidthDetailsLeft()}" (window:resize)="onResize($event)" id="pageResize"
        style="padding-top: 0;">
        <div class="row h-100">
            <div class="page-main" style="padding-top: 5px;height: 100%;">
                <div class="w-100" style="height: 60px !important;">
                    <ng-container *ngTemplateOutlet="pagethongtin"></ng-container>
                </div>
                <div class="w-100">
                    <ng-container *ngTemplateOutlet="pagemessage"></ng-container>
                </div>
                <div class="w-100" style="height: 60px !important;">
                    <ng-container *ngTemplateOutlet="pageinputchat"></ng-container>
                </div>
            </div>
        </div>
    </div>
    <div style="width: 350px;padding: 0;" [ngStyle]="{ 'height': getHeightMainRight() }">
        <div class="page-main-right">
            <div #vtabchitiet class="card" style="margin: 0;background: #FFF;"
                [ngStyle]="{ 'height': (!hideTabAttachment || !hideTabActivity) ? 'max-content' : getHeightChiTiet() }">
                <div class="card-header-detail page-title-ct" style="display: flex;">
                    <div class="title" style="flex-grow: 1; text-align: left;align-self: center;">
                        <span class="title-header-infoticket">Thông tin yêu cầu</span>
                    </div>

                </div>
                <div class="card">
                    <ng-container *ngTemplateOutlet="tabchitiet"></ng-container>
                </div>
            </div>

            <div #vtabtailieu class="card" style="margin-top:5px;margin-bottom:5px;background: #FFF;">
                <div class="card-header-attachment" style="display: flex;">
                    <div class="title" style="flex-grow: 1; text-align: left; align-self: center;">
                        <span class="title-header-att-act">Tài liệu đính kèm</span>

                    </div>
                    <div style="float: right;">
                        <i (click)="onClickHideTabAttachment()"
                            style="justify-content: center; align-items: center; display: inline-flex;font-size: 20px;"
                            [ngStyle]="{ 'margin-right': (IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket) ? '5px' : '15px' }"
                            [ngClass]="!hideTabAttachment ? 'fa fa-caret-down' : 'fa fa-caret-left'"
                            class="fa fa-caret-down" aria-hidden="true"></i>

                        <span *ngIf="IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket"
                            matTooltip="Thêm tài liệu" style="float: right;right:0;background-repeat: no-repeat;
                        height: 20px;width: 34px;color:#0e72d8;" class="material-icons" (click)="selectFile()">
                            add_circle
                        </span>
                        <input #myInput placeholder="Chọn file" id="imgInpdd1" type="file" name="myInput" multiple
                            style="display: none;" (change)="FileSelected($event)">

                    </div>

                </div>
                <div [ngStyle]="{ 'display': getDisplayAttachment() }" class="card-body">
                    <ng-container *ngTemplateOutlet="tabtailieu"></ng-container>
                </div>
            </div>
            <div #vtabhoatdong class="card" style="background: #FFF;">
                <div class="card-header-attachment" style="display: flex;">
                    <div class="title" style="flex-grow: 1; text-align: left; align-self: center;width: 70%;">
                        <span class="title-header-att-act">Hoạt động</span>

                    </div>
                    <div style="float: right;width: 20%;text-align: right;padding-right: 15px;">
                        <i (click)="onClickHideTabActivity()"
                            style="justify-content: center; align-items: center; display: inline-flex;font-size: 20px;"
                            [ngClass]="!hideTabActivity ? 'fa fa-caret-down' : 'fa fa-caret-left'"
                            aria-hidden="true"></i>
                    </div>

                </div>
                <div [ngStyle]="{ 'display': getDisplayActivity() }">
                    <div *ngIf="ticketPcDTO" class=" row  align-items-center"
                        style="padding-left: 15px !important;overflow: auto !important;"
                        [ngStyle]="{ height: getHeight_hoatdong() }">
                        <div style="height: 100%;">
                            <div class="page-chitiet" style="width: 100%;padding: 0px !important;">
                                <div class="activity-row"
                                    *ngFor="let activity of this.ticketPcDTO.Activity;let index = index"
                                    style="height: 50px;">
                                    <div>
                                        <span class="time-activity">{{(activity.Time) | timeAgoCus}}</span>
                                    </div>
                                    <div>
                                        <div><span class="name-activity">
                                                {{activity.fullname}}</span><span class="nd-activity"> 
                                                {{activity.ActionText}}</span></div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<ng-template #pagethongtin>
    <div *ngIf="ticketPcDTO"  style="padding-bottom: 10px;border-right: 1px solid rgba(0, 0, 0, 0.125);">
        <div class="col-avatar">
            <ngx-avatar [size]="40" matTooltip="{{this.ticketPcDTO.User.fullname}}"
                src="{{this.ticketPcDTO.User.image}}"
                *ngIf="this.ticketPcDTO.User.image && this.ticketPcDTO.User.image!=undefined  ;else bindText">
            </ngx-avatar>
            <ng-template #bindText>
                <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{this.ticketPcDTO.User.fullname}}" [size]="40"
                    [name]="getName(this.ticketPcDTO.User.fullname)"
                    bgColor="{{getColorNameUser(this.ticketPcDTO.User.fullname)}}">
                </ngx-avatar>
            </ng-template>

        </div>

        <div class="col-content">
            <div>
                <div *ngIf="IdStatus_Dahuyyeucau != status_ticket  && IdStatus_Closed != status_ticket;else Dahuy8">
                    <div *ngIf="!edit;else edittitle" class="item-title title-three-dot" matTooltip="{{this.ticketPcDTO.Title}}">
                        {{this.ticketPcDTO.Title}}
                        &nbsp;<mat-icon *ngIf="this.ticketPcDTO.User.userid == this.user_login"
                            style="font-size: 10px;color:#0e72d8;height: 10px;" (click)="edit_title()">
                            border_color
                        </mat-icon>
                    </div>
                    <ng-template #edittitle>
                        <input [(ngModel)]="Title" id="txttitle" type="text" class="form-input-title row  w-100" #input
                            (keyup.enter)="Update_title()">
                        <mat-error *ngIf="Title.length > 100">
                            Tiêu đề không vượt quá 100 ký tự
                        </mat-error>
                    </ng-template>
                </div>
                <ng-template #Dahuy8>
                    <div class="item-title title-three-dot" matTooltip="{{this.ticketPcDTO.Title}}">
                        {{this.ticketPcDTO.Title}}
                    </div>
                </ng-template>
            </div>
            <div>
                <div class="item-desception HienDauBaCham">
                    {{this.ticketPcDTO.Category[0].Title}}
                </div>
            </div>
            <div>
                <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket;else Dahuy4"
                    class="item-date three-dot-content" style="float: left;" [ngStyle]="{'max-width': getWidthTags() }">
                    <span class="item-name">{{this.ticketPcDTO.User.fullname}}&nbsp;</span>
                    {{this.FormatTimeService.format_convertDate(this.ticketPcDTO.CreatedDate,2,true)}}
                    &nbsp;
                    <ng-container *ngFor="let tag of this.ticketPcDTO.Tag">
                        <kt-cu-tag [role]="true" [tag]=this.TransformIntoObjectTag(tag.RowID,tag.Tag,tag.Color)
                            [node]="TransformIntoObjectNode(this.TicKetID)" (RemoveTag)="RemoveTag($event)" 
                            (LoadData)="ReloadData($event)"></kt-cu-tag>
                            
                    </ng-container>

                </div>
                <div style="float: left;width: 20px">
                    
                    <ng-container>
                        <i class="fas fa-tags" matTooltip="Thêm nhãn" [matMenuTriggerFor]="tag" 
                            (menuOpened)="node.showtag = true" (menuClosed)="node.showtag = false"></i>&nbsp;
                    </ng-container>

                    <mat-menu #tag="matMenu">
                        <ng-container *ngIf="node.showtag">
                            <!-- <kt-choose-milestone-and-tags (click)="$event.stopPropagation()" [options]="list_milestone"
                                [Id]="this.TicKetID" [Loai]="'Tags'" (ItemSelected)="ReloadData($event)">
                            </kt-choose-milestone-and-tags> -->
                            <kt-choose-milestone-and-tags-detail-ticket (click)="$event.stopPropagation()" [options]="list_milestone" [TagTicket]="this.ticketPcDTO.Tag"
                            [Id]="this.TicKetID" [Loai]="'Tags'" (ItemSelected)="ReloadData($event)">
                        </kt-choose-milestone-and-tags-detail-ticket>
                        </ng-container>
                    </mat-menu>
                </div>
                <ng-template #Dahuy4>
                    <div class="item-date HienDauBaCham">
                        <span class="item-name">{{this.ticketPcDTO.User.fullname}}&nbsp;</span>
                        {{this.FormatTimeService.format_convertDate(this.ticketPcDTO.CreatedDate,2,true)}}
                        &nbsp;
                        <ng-container *ngFor="let tag of this.ticketPcDTO.Tag">
                            <kt-cu-tag [no_update]="false" [role]="true"
                                [tag]=this.TransformIntoObjectTag(tag.RowID,tag.Tag,tag.Color)
                                [node]="TransformIntoObjectNode(this.TicKetID)" (LoadData)="ReloadData($event)">
                            </kt-cu-tag>
                        </ng-container>
                    </div>
                </ng-template>
            </div>
        </div>
        <div class="col-rating">
            <div style="justify-content: right;">
                <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket && this.ticketPcDTO.User.userid == this.user_login"
                    style="float: right;right:0">
                    <button mat-button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Hủy yêu cầu"
                        style="height: 20px;width: 20px;">
                        <i style="display: flex;padding-left: 10px;" class="fa fa-ellipsis-v btn-3cham-huyyeucau"
                            aria-hidden="true"></i>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="Huyyeucau()">
                            <i class="flaticon2-delete" style="color: red;"></i>&nbsp;
                            <span>Hủy yêu cầu</span>
                        </button>
                    </mat-menu>
                </div>
                <div *ngIf="IdStatus_Dahuyyeucau != status_ticket;else Dahuy" style="float:right">
                    <div *ngIf="this.ticketPcDTO.User.userid == this.user_login;else norating"
                        style="text-align: right !important;" (click)="Update_rating()">
                        <span *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                            class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                        <span *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                            class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                    </div>
                    <ng-template #norating>

                        <div style="text-align: right !important;">
                            <span *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                                class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                            <span *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                                class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                        </div>
                    </ng-template>
                </div>
                <ng-template #Dahuy>
                    <div style="text-align: right !important;">
                        <span *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                            class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                        <span *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                            class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                    </div>
                </ng-template>
            </div>

        </div>
     
    </div>



</ng-template>
<ng-template #pagethongtinv>
    <div *ngIf="ticketPcDTO">
        <div style="padding-bottom: 10px;border-right: 1px solid rgba(0, 0, 0, 0.125);">
            <table style="width: 100%;">
                <tr>
                    <td rowspan="2" style="width:5%; padding-left: 5px;">
                        <div style="padding: 5px 10px 0 0;float: left;display: block !important">
                            <ngx-avatar [size]="40" matTooltip="{{this.ticketPcDTO.User.fullname}}"
                                src="{{this.ticketPcDTO.User.image}}"
                                *ngIf="this.ticketPcDTO.User.image && this.ticketPcDTO.User.image!=undefined  ;else bindText">
                            </ngx-avatar>
                            <ng-template #bindText>
                                <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{this.ticketPcDTO.User.fullname}}"
                                    [size]="40" [name]="getName(this.ticketPcDTO.User.fullname)"
                                    bgColor="{{getColorNameUser(this.ticketPcDTO.User.fullname)}}">
                                </ngx-avatar>
                            </ng-template>


                        </div>

                    </td>
                    <td style="width: 73%;padding: 0;">
                        <div
                            *ngIf="IdStatus_Dahuyyeucau != status_ticket  && IdStatus_Closed != status_ticket;else Dahuy8">
                            <div *ngIf="!edit;else edittitle" class="item-title title-three-dot">
                                {{this.ticketPcDTO.Title}}
                                &nbsp;<mat-icon *ngIf="this.ticketPcDTO.User.userid == this.user_login"
                                    style="font-size: 10px;color:#0e72d8;height: 10px;" (click)="edit_title()">
                                    border_color
                                </mat-icon>
                            </div>
                            <ng-template #edittitle>
                                <input [(ngModel)]="Title" id="txttitle" type="text" class="form-input-title row  w-100"
                                    #input (keyup.enter)="Update_title()">
                                <mat-error *ngIf="Title.length > 100">
                                    Tiêu đề không vượt quá 100 ký tự
                                </mat-error>
                            </ng-template>
                        </div>
                        <ng-template #Dahuy8>
                            <div class="item-title title-three-dot">
                                {{this.ticketPcDTO.Title}}
                            </div>
                        </ng-template>


                    </td>
                    <td style="width: 20%;">
                        <div>
                            <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket && this.ticketPcDTO.User.userid == this.user_login"
                                style="float: right;right:0">
                                <button mat-button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Hủy yêu cầu"
                                    style="height: 20px;width: 20px;">
                                    <i style="display: flex;padding-left: 10px;"
                                        class="fa fa-ellipsis-v btn-3cham-huyyeucau" aria-hidden="true"></i>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="Huyyeucau()">
                                        <i class="flaticon2-delete" style="color: red;"></i>&nbsp;
                                        <span>Hủy yêu cầu</span>
                                    </button>
                                </mat-menu>
                            </div>
                            <div *ngIf="IdStatus_Dahuyyeucau != status_ticket;else Dahuy" style="float:right">
                                <div *ngIf="this.ticketPcDTO.User.userid == this.user_login;else norating"
                                    style="text-align: right !important;" (click)="Update_rating()">
                                    <span *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                                        class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                                    <span *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                                        class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                                </div>
                                <ng-template #norating>

                                    <div style="text-align: right !important;">
                                        <span
                                            *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                                            class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                                        <span
                                            *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                                            class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                                    </div>
                                </ng-template>
                            </div>
                            <ng-template #Dahuy>
                                <div style="text-align: right !important;">
                                    <span *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index"
                                        class="fa fa-star" style="color: #FFC107;font-size: 16px;"></span>
                                    <span *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index"
                                        class="fa fa-star" style="color:#E6E6FA;font-size: 16px;"></span>

                                </div>
                            </ng-template>
                        </div>

                    </td>
                </tr>
                <tr>
                    <td style="width: 73%;">
                        <div class="item-desception HienDauBaCham">
                            {{this.ticketPcDTO.Category[0].Title}}
                        </div>
                    </td>
                    <td style="width: 20%;">

                    </td>
                </tr>
                <tr>
                    <td>

                    </td>
                    <td style="width: 73%;">

                        <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && IdStatus_Closed != status_ticket;else Dahuy4"
                            class="item-date HienDauBaCham">
                            <span class="item-name">{{this.ticketPcDTO.User.fullname}}&nbsp;</span>
                            {{this.FormatTimeService.format_convertDate(this.ticketPcDTO.CreatedDate,2,true)}}
                            &nbsp;
                            <ng-container *ngFor="let tag of this.ticketPcDTO.Tag">
                                <kt-cu-tag [role]="true" [tag]=this.TransformIntoObjectTag(tag.RowID,tag.Tag,tag.Color)
                                    [node]="TransformIntoObjectNode(this.TicKetID)" (RemoveTag)="RemoveTag($event)"
                                    (LoadData)="ReloadData($event)"></kt-cu-tag>
                            </ng-container>
                            &nbsp;
                            <ng-container>
                                <i class="fas fa-tags" matTooltip="Thêm nhãn" [matMenuTriggerFor]="tag"
                                    (menuOpened)="node.showtag = true" (menuClosed)="node.showtag = false"></i>&nbsp;
                            </ng-container>

                            <mat-menu #tag="matMenu">
                                <ng-container *ngIf="node.showtag">
                                    <kt-choose-milestone-and-tags (click)="$event.stopPropagation()"
                                        [options]="list_milestone" [Id]="this.TicKetID" [Loai]="'Tags'"
                                        (ItemSelected)="ReloadData($event)">
                                    </kt-choose-milestone-and-tags>
                                </ng-container>
                            </mat-menu>
                        </div>
                        <ng-template #Dahuy4>
                            <div class="item-date HienDauBaCham">
                                <span class="item-name">{{this.ticketPcDTO.User.fullname}}&nbsp;</span>
                                {{this.FormatTimeService.format_convertDate(this.ticketPcDTO.CreatedDate,2,true)}}
                                &nbsp;
                                <ng-container *ngFor="let tag of this.ticketPcDTO.Tag">
                                    <kt-cu-tag [no_update]="false" [role]="true"
                                        [tag]=this.TransformIntoObjectTag(tag.RowID,tag.Tag,tag.Color)
                                        [node]="TransformIntoObjectNode(this.TicKetID)" (LoadData)="ReloadData($event)">
                                    </kt-cu-tag>
                                </ng-container>

                            </div>
                        </ng-template>
                    </td>

                </tr>
            </table>



        </div>
    </div>



</ng-template>



<ng-template #pagemessage>

    <div style="padding-bottom: 10px !important;" [ngStyle]="{height: getHeight_Mess() }"
        class="overflow-auto scroller page-messagess" #scrollMe [scrollTop]="scrollMe.scrollHeight">

        <div *ngIf="this.hideDescription && this.typeDescription == 1;else zoominDesscription"
            [ngStyle]="{'width': getWidthDetailsLeft()}"
            style="height: max-content;max-height: 70px; position: fixed; border-radius: 5px; overflow: hidden; ">
            <div class="page-messagess" style="height: 10px !important;z-index: 1000;position: relative;"></div>
            <div *ngIf="ticketPcDTO"
                style="width: 100%; height: max-content;max-height: 90px;  justify-content: center; align-items: center; display: inline-flex;padding: 0 10px;">
                <div class="bg-description"
                    style="width: 100%; height: max-content;max-height: 90px; position: relative; flex-direction: column; justify-content: flex-start; align-items: flex-start; display: flex;padding: 0 10px;">
                    <div style="width: 100%;height: max-content;max-height: 40px; position: relative;padding-top: 5px">
                        <div style="width: 100%; left: 10px;right: 20px; top: 0px; color: #0C1C34; font-size: 14px; font-family: Helvetica; font-weight: 500;
                         word-wrap: break-word">
                            <p class="text-description" [innerHTML]="this.ticketPcDTO.Description"></p>
                            <div style="width: 100% ;">
                                <img *ngFor="let att of filter_Attachment(1,this.ticketPcDTO.Document);let index = index"
                                    style="width: 150px; height: 150px;  border-radius: 6px;margin-right: 20px;margin-bottom: 15px;"
                                    src="{{backgroupImage(filter_Attachment(1,this.ticketPcDTO.Document),index)}}" />


                            </div>
                        </div>
                    </div>
                    <div style="width: 100%; height: 20px; position: relative">
                        <div class="gradient-description"
                            style="width: 100%; height: 50px; left: 0px; top: -15px; position: absolute; ">
                        </div>
                        <div [ngStyle]="{'left': getpaddingLeft()}"
                            style="width: 24px; height: 30px; padding-top: 5.29px; padding-bottom: 5.29px;
                         padding-left: 9.40px; padding-right: 7.31px;  position: absolute; transform: rotate(90deg); transform-origin: 0 0; justify-content: center; align-items: center; display: inline-flex">
                            <div (click)="zoomDepscription()" class="fa fa-chevron-right"
                                style="width: 7.29px; height: 13.41px; color: #888686;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <ng-template #zoominDesscription>
            <div *ngIf="this.hideDescription && ticketPcDTO" [ngStyle]="{'width': getWidthDetailsLeft()}"
                style="z-index: 10;height: max-content;max-height: 350px !important;position: fixed; border-radius: 5px;padding: 0 10px;  ">
                <div class="page-messagess" style="height: 10px !important;z-index: 1000;position: relative;"></div>
                <div
                    style="width: 100%; height: max-content;max-height: 350px;  justify-content: center; align-items: center; display: inline-flex;">
                    <div class="bg-description"
                        style="width: 100%; height: max-content;max-height: 350px; flex-direction: column; justify-content: flex-start; align-items: flex-start;padding: 0 10px;">
                        <div
                            style="width: 100%;overflow: auto;height: max-content;max-height: 350px !important;padding-top: 5px;">
                            <div class="text-description"
                                style="width: 100%;  font-size: 14px; font-family: Helvetica; font-weight: 500; word-wrap: break-word">
                                <p [innerHTML]="this.ticketPcDTO.Description"></p>

                            </div>

                            <div style="width: 100% ;margin-top: 10px;margin-bottom: 15px;">
                                <img *ngFor="let att of filter_Attachment(1,this.ticketPcDTO.Document);let index = index"
                                    style="width: 150px; height: 150px;  border-radius: 6px;margin-right: 20px;margin-bottom: 15px;"
                                    src="{{backgroupImage(filter_Attachment(1,this.ticketPcDTO.Document),index)}}" />


                            </div>

                        </div>
                        <div style="width: 100%; height: 10%; justify-content: center;display: inline-flex;">
                            <div
                                style="width: 10px; height: 20px; padding-top: 5.29px; padding-bottom: 5.29px; padding-left: 9.40px; padding-right: 7.31px; top: 51px; justify-content: center; align-items: center;">
                                <div (click)="zoomDepscription()" class="fa fa-chevron-up"
                                    style="width: 7.29px; height: 13.41px;color: #888686; "></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>

        <div *ngFor="let us of filterMessageThread(messageService.messageThread$) | async let index = index"
            class="overflow-auto" style="margin-bottom: 15px;" [ngStyle]="{'padding-top': getpaddingTopMess(index)}">
            <div *ngIf="us.disPlaytimeGroup" style="text-align: center;padding-bottom: 20px;">
                <div>
                    <span class="displaytimethem" [innerHTML]="DisplayTime(us.disPlaytimeGroup)"></span>
                </div>
            </div>
            <div *ngIf="us.CreateddBy != user_login;else RespoFalse" class="row mess1">
                <div class="row" style="width: 100%;;justify-content: left;">

                    <div class="col-md-10">
                        <div style="float: left;max-width: 100%;">
                            <div style="float: left;width: 50px;    justify-content: center;
                            display: inline-flex;">
                                <ngx-avatar [size]="30" matTooltip="{{us.fullname}}" src="{{us.image}}"
                                    *ngIf="us.image;else bindText2">
                                </ngx-avatar>
                                <ng-template #bindText2>
                                    <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{us.fullname}}" [size]="30"
                                        [name]="getName(us.fullname)" bgColor="{{getColorNameUser(us.fullname)}}">
                                    </ngx-avatar>
                                </ng-template>
                            </div>
                            <div class="mess_doc1"
                                style="max-width: calc(100% - 50px);float: left;justify-content: left;">
                                <div class="title_mess">
                                    <div style="padding-left: 10px;">
                                        <span class="name"> {{us.fullname}}
                                        </span>
                                        <br />
                                    </div>


                                    <div class="nd-mess" *ngIf="us.Message">
                                        <p [innerHTML]="us.Message"></p>
                                    </div>

                                    <div *ngIf="us.Type == 2;else bindFile">
                                        <img *ngFor="let img of us.Attachment"
                                            style=" width: 300px;border-radius: inherit;cursor: pointer;"
                                            src="{{img.hinhanh}}" (click)="preview(img,us.Type)">

                                    </div>


                                    <ng-template #bindFile>
                                        <div [ngClass]="getClassfileRight(us.UserName)" *ngIf="us.Attachment.length>0">
                                            <div *ngFor="let file of us.Attachment let vifile=index">

                                                <div style="display:flex ;flex-direction:column ;">


                                                    <div style="display: flex;cursor: pointer;align-items: center;">
                                                        <div style="display: flex;align-items:center ;"
                                                            (click)="preview(file)">


                                                            <div>
                                                                <img style="width:25px !important ;height:25px !important ;"
                                                                    src=" {{ file.icon }}" />
                                                                <div>
                                                                    <img style="    float: right;
                                                  width: 10px;
                                                  height: 10px;
                                                  margin-top: -5px;
                                                " src="../../../../../../assets/media/mime/icontick.png">
                                                                </div>

                                                            </div>
                                                            <span style="    font-weight: bold;
                                              padding-left: 5px;">{{ file.filename }}
                                                                <br>

                                                            </span>

                                                        </div>
                                                        <i [ngClass]="getClassDownload(file.isDownload)"
                                                            (click)="saveOrOpenBlob(file.Link,file.filename,file.disabled,index,vifile,us.IdGroup,us.IdChat,file.id_att)"
                                                            class="fas fa-download dow"></i>
                                                    </div>

                                                    <div style="padding-left: 10px;">

                                                        <div id="downloadfile{{index}}{{vifile}}">
                                                            <div id="progress{{index}}{{vifile}}">

                                                                <span id="progress-text{{index}}{{vifile}}"></span>
                                                            </div>

                                                        </div>


                                                        <span id="kbdownload{{index}}{{vifile}}"></span>



                                                    </div>
                                                    <div *ngIf="file.disabled==true">
                                                        <div>
                                                            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                                                        </div>
                                                        <div class="progress"
                                                            *ngIf="progress&&id_chat_notify==us.IdChat">
                                                            <div class="progress-bar" [style.width]="progress + '%'">
                                                                {{progress}}%</div>
                                                            <br>

                                                        </div>


                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </ng-template>
                                    <div style="padding: 2px 10px;">
                                        <span class="date-mess">
                                            {{this.FormatTimeService.format_convertDate(us.CreatedDate,2,true)}}
                                        </span>
                                        <br />
                                    </div>


                                </div>
                            </div>


                        </div>

                    </div>
                    <div class="col-md-2">

                    </div>



                </div>

            </div>
            <ng-template #RespoFalse class="row mess2">
                <div class="row" style="width: 100%;;justify-content: right;">
                    <div class="col-md-2">

                    </div>
                    <div class="col-md-10">
                        <div style="float: right;max-width: 100%;">
                            <div class="mess_doc2"
                                style="max-width: calc(100% - 50px);float: left;justify-content: right;">
                                <div class="title_mess">
                                    <div style="padding-left: 10px;">
                                        <span class="name"> {{us.fullname}}
                                        </span>
                                        <br />
                                    </div>


                                    <div class="nd-mess" *ngIf="us.Message">
                                        <p [innerHTML]="us.Message"></p>
                                    </div>

                                    <div *ngIf="us.Type == 2;else bindFile">
                                        <img *ngFor="let img of us.Attachment"
                                            style=" width: 300px;border-radius: inherit;cursor: pointer;"
                                            src="{{img.hinhanh}}" (click)="preview(img,us.Type)">

                                    </div>


                                    <ng-template #bindFile>
                                        <div [ngClass]="getClassfileRight(us.UserName)" *ngIf="us.Attachment.length>0">
                                            <div *ngFor="let file of us.Attachment let vifile=index">

                                                <div style="display:flex ;flex-direction:column ;">


                                                    <div style="display: flex;cursor: pointer;align-items: center;">
                                                        <div style="display: flex;align-items:center ;"
                                                            (click)="preview(file)">


                                                            <div>
                                                                <img style="width:25px !important ;height:25px !important ;"
                                                                    src=" {{ file.icon }}" />
                                                                <div>
                                                                    <img style="    float: right;
                                                  width: 10px;
                                                  height: 10px;
                                                  margin-top: -5px;
                                                " src="../../../../../../assets/media/mime/icontick.png">
                                                                </div>

                                                            </div>
                                                            <span style="    font-weight: bold;
                                              padding-left: 5px;">{{ file.filename }}
                                                                <br>

                                                            </span>

                                                        </div>
                                                        <i [ngClass]="getClassDownload(file.isDownload)"
                                                            (click)="saveOrOpenBlob(file.Link,file.filename,file.disabled,index,vifile,us.IdGroup,us.IdChat,file.id_att)"
                                                            class="fas fa-download dow"></i>
                                                    </div>

                                                    <div style="padding-left: 10px;">

                                                        <div id="downloadfile{{index}}{{vifile}}">
                                                            <div id="progress{{index}}{{vifile}}">

                                                                <span id="progress-text{{index}}{{vifile}}"></span>
                                                            </div>

                                                        </div>


                                                        <span id="kbdownload{{index}}{{vifile}}"></span>



                                                    </div>
                                                    <div *ngIf="file.disabled==true">
                                                        <div>
                                                            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                                                        </div>
                                                        <div class="progress"
                                                            *ngIf="progress&&id_chat_notify==us.IdChat">
                                                            <div class="progress-bar" [style.width]="progress + '%'">
                                                                {{progress}}%</div>
                                                            <br>

                                                        </div>


                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </ng-template>
                                    <div style="padding: 2px 10px;">
                                        <span class="date-mess">
                                            {{this.FormatTimeService.format_convertDate(us.CreatedDate,2,true)}}
                                        </span>
                                        <br />
                                    </div>


                                </div>
                            </div>

                            <div style="float: right;width: 50px;    justify-content: center;
                            display: inline-flex;">
                                <ngx-avatar [size]="30" matTooltip="{{us.fullname}}" src="{{us.image}}"
                                    *ngIf="us.image;else bindText2">
                                </ngx-avatar>
                                <ng-template #bindText2>
                                    <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{us.fullname}}" [size]="30"
                                        [name]="getName(us.fullname)" bgColor="{{getColorNameUser(us.fullname)}}">
                                    </ngx-avatar>
                                </ng-template>
                            </div>
                        </div>

                    </div>




                </div>
                <!-- <table style="max-width:70%;float:right;display: block;">
                    <tr>
                        <td style="text-align: start;" class="mess_doc2">
                            <div class="title_mess">
                                <div style="padding-left: 10px;">
                                    <span class="name"> {{us.fullname}}
                                    </span>
                                    <br />
                                </div>


                                <div class="nd-mess" *ngIf="us.Message">
                                    <p [innerHTML]="us.Message"></p>
                                </div>

                                <div *ngIf="us.Type == 2;else bindFile">
                                    <img *ngFor="let img of us.Attachment"
                                        style=" width: 300px;border-radius: inherit;cursor: pointer;"
                                        src="{{img.hinhanh}}" (click)="preview(img,us.Type)">

                                </div>


                                <ng-template #bindFile>
                                    <div [ngClass]="getClassfileRight(us.UserName)" *ngIf="us.Attachment.length>0">
                                        <div *ngFor="let file of us.Attachment let vifile=index">

                                            <div style="display:flex ;flex-direction:column ;">


                                                <div style="display: flex;cursor: pointer;align-items: center;">
                                                    <div style="display: flex;align-items:center ;"
                                                        (click)="preview(file)">


                                                        <div>
                                                            <img style="width:25px !important ;height:25px !important ;"
                                                                src=" {{ file.icon }}" />
                                                            <div>
                                                                <img style="    float: right;
                                              width: 10px;
                                              height: 10px;
                                              margin-top: -5px;
                                            " src="../../../../../../assets/media/mime/icontick.png">
                                                            </div>

                                                        </div>
                                                        <span style="    font-weight: bold;
                                          padding-left: 5px;">{{ file.filename }}
                                                            <br>

                                                        </span>

                                                    </div>
                                                    <i [ngClass]="getClassDownload(file.isDownload)"
                                                        (click)="saveOrOpenBlob(file.Link,file.filename,file.disabled,index,vifile,us.IdGroup,us.IdChat,file.id_att)"
                                                        class="fas fa-download dow"></i>
                                                </div>

                                                <div style="padding-left: 10px;">

                                                    <div id="downloadfile{{index}}{{vifile}}">
                                                        <div id="progress{{index}}{{vifile}}">

                                                            <span id="progress-text{{index}}{{vifile}}"></span>
                                                        </div>

                                                    </div>


                                                    <span id="kbdownload{{index}}{{vifile}}"></span>



                                                </div>
                                                <div *ngIf="file.disabled==true">
                                                    <div>
                                                        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
                                                    </div>
                                                    <div class="progress" *ngIf="progress&&id_chat_notify==us.IdChat">
                                                        <div class="progress-bar" [style.width]="progress + '%'">
                                                            {{progress}}%</div>
                                                        <br>

                                                    </div>


                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </ng-template>
                                <div style="padding: 2px 10px;">
                                    <span class="date-mess">
                                        {{this.FormatTimeService.format_convertDate(us.CreatedDate,2,true)}}
                                    </span>
                                    <br />
                                </div>


                            </div>
                        </td>
                        <td style="vertical-align: top;padding-right: 10px;padding-left: 10px;">
                            <ngx-avatar [size]="30" matTooltip="{{us.fullname}}" src="{{us.image}}"
                                *ngIf="us.image;else bindText2">
                            </ngx-avatar>
                            <ng-template #bindText2>
                                <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{us.fullname}}" [size]="30"
                                    [name]="getName(us.fullname)" bgColor="{{getColorNameUser(us.fullname)}}">
                                </ngx-avatar>
                            </ng-template>
                        </td>
                    </tr>
                </table> -->
            </ng-template>
        </div>
        <div
            *ngIf="this.ticketPcDTO && this.ticketPcDTO.Rating != 0 && (IdStatus_Dahuyyeucau == this.ticketPcDTO.Status.RowID||IdStatus_Closed == this.ticketPcDTO.Status.RowID)">
            <div style="text-align: center;padding-bottom: 20px;">
                <div>
                    <span class="displaytimethem" [innerHTML]="DisplayTime(this.ticketPcDTO.Time_rating)"></span>
                </div>
                <div (click)="Update_rating()" class="rating-detail" style="cursor: pointer;">
                    <div class="header-rating">
                        <div class="title-rating">Đánh giá hỗ trợ</div>
                        <div *ngIf="this.ticketPcDTO.Content_rating;" class="content-rating">
                            {{this.ticketPcDTO.Content_rating}}</div>
                    </div>
                    <div
                        style="flex-direction: column; justify-content: flex-start; align-items: center; gap: 5px; display: flex">
                        <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && this.ticketPcDTO.User.userid == this.user_login"
                            style="text-align: center; color: #808080; font-size: 12px; font-family: Helvetica; font-weight: 400; word-wrap: break-word">
                            Nhấn để đánh giá</div>
                        <div *ngIf="IdStatus_Dahuyyeucau != status_ticket && this.ticketPcDTO.User.userid == this.user_login;else noratingticket"
                            style="justify-content: flex-start; align-items: flex-start; gap: 5px; display: inline-flex">
                            <div style="width: 40px; height: 40px; position: relative"
                                *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index">
                                <div class="fa fa-star"
                                    style="width: 30px; height: 30px; left: 5px; top: 5px; position: absolute; color: #FFC107;font-size: 40px;">
                                </div>
                            </div>
                            <div style="width: 40px; height: 40px; position: relative"
                                *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index">
                                <div class="fa fa-star"
                                    style="width: 30px; height: 30px; left: 5px; top: 5px; position: absolute; color:#E6E6FA;;font-size: 40px;">
                                </div>
                            </div>
                        </div>
                        <ng-template #noratingticket>
                            <div
                                style="justify-content: flex-start; align-items: flex-start; gap: 5px; display: inline-flex">
                                <div style="width: 40px; height: 40px; position: relative"
                                    *ngFor="let item of [].constructor(this.ticketPcDTO.Rating); let i = index">
                                    <div class="fa fa-star"
                                        style="width: 30px; height: 30px; left: 5px; top: 5px; position: absolute; color: #FFC107;font-size: 40px;">
                                    </div>
                                </div>
                                <div style="width: 40px; height: 40px; position: relative"
                                    *ngFor="let item of [].constructor(5-this.ticketPcDTO.Rating); let i = index">
                                    <div class="fa fa-star"
                                        style="width: 30px; height: 30px; left: 5px; top: 5px; position: absolute; color:#E6E6FA;;font-size: 40px;">
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <ng-template #chuacotinnhan>
        <div style="margin-bottom: 15px!important;background-color: #7a7a7a1f;border-radius: 5px;text-align: center;"
            [ngStyle]="{ height: getHeight_Mess() }">
            Chưa có tin nhắn
        </div>
    </ng-template>
</ng-template>
<ng-template #pageinputchat>

    <div *ngIf="ticketPcDTO" class="message-input" style="position: inherit !important;">
        <div class="wrap quill-mess">
            <div>
                <div *ngIf="myFilesVideo.length">
                    <div style="position:absolute" [ngStyle]="{'bottom': getBottomVideo()}"
                        *ngFor="let video of myFilesVideo;let indexvd=index">


                        <div style="width: 20px;">
                            <button (click)="RemoveVideos(indexvd)" class="closebtn" mat-button mat-icon-button>
                                <i class="fa fa-times" aria-hidden="true"></i>
                            </button>
                        </div>
                        <video [src]="video" height="200" controls></video>

                    </div>
                </div>
                <!--  begin image -->
                <div style="height: 150px;position:absolute;padding-bottom: 15px;display: flex"
                    [ngStyle]="{'bottom': getBottomImage()}" *ngIf="list_image.length>0">
                    <div style="display: -webkit-inline-box;">


                        <div style="display: flex;" *ngFor="let img of list_image;let viimg=index">
                            <div style="width: 20px;">
                                <button (click)="RemoveChoseImage(viimg)" class="closebtn" mat-button mat-icon-button>
                                    <i class="fa fa-times" aria-hidden="true"></i>
                                </button>
                            </div>
                            <img [src]="img" style="width: 100%;
                      height: 100%;;margin: 10px;">
                        </div>
                        <button style="height: 100%;
              margin:auto;
              border-radius: 10% !important;" (click)="hiddenfileinput_image.click()" matTooltip="Hỉnh ảnh"
                            mat-icon-button aria-label="Example icon button with a home icon">
                            <mat-icon class="sizeiconreaction">add_photo_alternate</mat-icon>
                        </button>
                        <input type='file' accept=".jpg, .png, .jpeg, .gif, .bmp, .tif, .heic, .heif, .tiff|image/*"
                            id="PDFInpdd" #hiddenfileinput_image (onChange)="onSelectFile_PDF($event)"
                            (click)="$event.target.value=null" multiple style="display: none;">

                    </div>
                </div>

                <!-- end image -->
                <!-- begin file  -->
                <div class="bodyfile" *ngIf="listFileChat.length>0">

                    <div style="display: flex;flex-wrap: wrap;">


                        <div class="file" *ngFor="let file of listFileChat;let vifile=index">
                            <div>

                                <i style="cursor:pointer ;" (click)="RemoveChoseFile(vifile)" class="fa fa-times"
                                    aria-hidden="true"></i>
                            </div>
                            <div class="attchamentfile">
                                <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58 58"
                                    style="enable-background:new 0 0 58 58; width: 40px;" xml:space="preserve">
                                    <polygon style="fill:#EDEADA;" points="51.5,14 37.5,0 6.5,0 6.5,58 51.5,58 " />
                                    <g>
                                        <path style="fill:#CEC9AE;"
                                            d="M16.5,23h25c0.552,0,1-0.447,1-1s-0.448-1-1-1h-25c-0.552,0-1,0.447-1,1S15.948,23,16.5,23z" />
                                        <path style="fill:#CEC9AE;"
                                            d="M16.5,15h10c0.552,0,1-0.447,1-1s-0.448-1-1-1h-10c-0.552,0-1,0.447-1,1S15.948,15,16.5,15z" />
                                        <path style="fill:#CEC9AE;"
                                            d="M41.5,29h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,29,41.5,29z" />
                                        <path style="fill:#CEC9AE;"
                                            d="M41.5,37h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,37,41.5,37z" />
                                        <path style="fill:#CEC9AE;"
                                            d="M41.5,45h-25c-0.552,0-1,0.447-1,1s0.448,1,1,1h25c0.552,0,1-0.447,1-1S42.052,45,41.5,45z" />
                                    </g>
                                    <polygon style="fill:#CEC9AE;" points="37.5,0 37.5,14 51.5,14 " />
                                </svg>
                                <div style="    display: flex;
                  flex-direction: column;">
                                    <span>{{file.filename}}</span>
                                    <span>{{formatBytesInsert(file.size)}}</span>
                                </div>

                            </div>
                        </div>
                    </div>
                    <button style="

                border-radius: 10% !important;" (click)="hiddenfileinput.click()" matTooltip="File" mat-icon-button
                        aria-label="Example icon button with a home icon">
                        <mat-icon class="sizeiconreaction">add_to_photos</mat-icon>
                    </button>
                    <input type='file' id="PDFInpdd" #hiddenfileinput (change)="onSelectFile_PDF($event)" multiple
                        style="display: none;">
                </div>
                <!-- end file  -->



                <div style="position:absolute;
            padding-bottom: 15px;
            display: flex;
            bottom: 200px;" *ngFor="let itrp of  listReply ">

                    <span> <mat-icon class="iconreply">reply</mat-icon>Trả lời {{itrp.FullName}}

                        <button matTooltip="Đóng" (click)="DeleteReply()" mat-icon-button color="primary">
                            <mat-icon style="font-size: 15px;">close</mat-icon>
                        </button>
                    </span>
                    <br>
                    <div *ngIf="itrp.Attachment.length>0">
                        <span *ngFor="let imgrep of itrp.Attachment ">
                            <img style="width: 50px;height: 50px;" [src]="imgrep.hinhanh">
                        </span>
                        <span *ngIf="itrp.Content_mess==''" style="padding-left: 10px;">
                            Tệp đính kèm

                        </span>
                    </div>
                    <div *ngIf="itrp.Attachment_File.length>0">
                        <div *ngFor="let file of itrp.Attachment_File " style="display: flex;cursor: pointer;">
                            <img style="width:50px ;height:50px ;" src=" {{ file.icon }}" />
                            <span style="    font-weight: bold;
                  padding-left: 5px;">{{ file.filename }}</span>

                        </div>
                        <!-- <span *ngIf="itrp.Content_mess==''" style="padding-left: 10px;">
                 Tệp đính kèm

                </span> -->
                    </div>
                    <span *ngIf="itrp.Content_mess!==''" style="padding-left: 10px;">
                        <label [innerHTML]="decryRep(itrp.Content_mess,itrp.isEncode)"></label>
                        <!-- {{itrp.Content_mess}} -->

                    </span>


                </div>

                <!--  phần  sticker -->
                <div style="width:350px ;" id="collapseBasic" #collapsesticker="ngbCollapse"
                    [(ngbCollapse)]="isCollapsedsticker">
                    <div>
                        <!-- begin store sticker -->
                        <div *ngIf="showstoresticker">



                            <mat-tab-group class="chattapgr" [selectedIndex]="selectedTabstore"
                                (selectedTabChange)="onTabChanged($event)">
                                <mat-tab>

                                    <ng-template mat-tab-label>
                                        <mat-icon>keyboard_arrow_left</mat-icon>
                                    </ng-template>

                                </mat-tab>
                                <mat-tab label="STORE SICKER">

                                    <mat-card style="height: 430px;padding: 0px;">
                                        <div style="
                        height: 380px;
                    ">
                                            <mat-card-content style="    margin-left: 10px;">

                                                <img *ngIf="listStoreSticker.length==0" style="    width: 350px;"
                                                    src="../../../../../../assets/media/custom/rong.png">
                                                <div *ngFor="let sticker of listStoreSticker">
                                                    <div>
                                                        <div style="display: flex;">


                                                            <div style="display: flex;
                            flex-direction: column;    width: 280px;">
                                                                <span style="font-weight: bold;">
                                                                    {{sticker.Title}}
                                                                </span>

                                                                <span style="font-size: 12px;">
                                                                    {{sticker.Slsticker}} sticker
                                                                </span>
                                                            </div>
                                                            <div *ngIf="!sticker.check"
                                                                (click)="downloadSticker(sticker.GrSticker,'insert')"
                                                                class="stickerdownload">
                                                                <span style="    padding: 5px;
                              font-size: 12px;"> Tải về</span>
                                                            </div>
                                                            <div *ngIf="sticker.check">
                                                                <img style="border-radius: 50%;
                                    height: 20px;" src="../../../../../../assets/media/custom/completesticker.png">
                                                            </div>

                                                        </div>

                                                        <img style="    height: 70px;" src="{{sticker.URLSticker}}">
                                                    </div>

                                                </div>



                                            </mat-card-content>
                                        </div>

                                    </mat-card>
                                    <!-- <div style="height: 430px;">
                          sticker
                      </div> -->
                                </mat-tab>
                                <mat-tab label="QUẢN LÝ STICKER">
                                    <mat-card style="height: 430px;padding: 0px;">
                                        <div style="
                        height: 380px;
                    ">
                                            <mat-card-content>
                                                <div *ngFor="let qlsticker of listQLStoreSticker">
                                                    <div>
                                                        <div style="display: flex;">


                                                            <div style="display: flex;
                                flex-direction: column;    width: 280px;">
                                                                <span style="font-weight: bold;">
                                                                    {{qlsticker.Title}}
                                                                </span>

                                                                <span style="font-size: 12px;">
                                                                    {{qlsticker.Slsticker}} sticker
                                                                </span>
                                                            </div>



                                                        </div>
                                                        <div style="display: flex;align-items: center;">
                                                            <img style="width: 250px;   height: 70px;"
                                                                src="{{qlsticker.URLSticker}}">
                                                            <div style="margin-left: 40px;"
                                                                (click)="downloadSticker(qlsticker.GrSticker,'remove')">
                                                                <mat-icon
                                                                    style="font-size:23px !important ;cursor: pointer;">delete_forever</mat-icon>
                                                            </div>
                                                        </div>

                                                    </div>

                                                </div>

                                                <img *ngIf="listQLStoreSticker.length==0" style="    width: 350px;"
                                                    src="../../../../../../assets/media/custom/rong.png">
                                                <!-- No Sticker -->



                                            </mat-card-content>
                                        </div>
                                    </mat-card>
                                </mat-tab>

                            </mat-tab-group>
                        </div>

                        <!--  end store sticker -->
                        <!-- begin hiển thị sticker -->
                        <mat-tab-group *ngIf="!showstoresticker" class="chattapgr" [selectedIndex]="selectedTab">
                            <!-- <mat-tab label="SICKER">

                    -->
                            <mat-tab label="EMOJI">


                                <span (click)="$event.stopPropagation(); false;">
                                    <emoji-mart class="emoji-mart" set="{{set}}" (emojiSelect)="addEmoji($event)"
                                        title="Pick your emoji…"></emoji-mart>
                                </span></mat-tab>

                        </mat-tab-group>

                    </div>
                </div>
                <!-- phần  sticker -->
                <div class="inpuchat">

                    <form style="width: 100%;" #messageForm="ngForm" autocomplete="off">

                        <quill-editor [formats]="formats" (onEditorCreated)="setFocus($event)" class="colortext"
                            placeholder="Nhập tin nhắn..." name="messageContent" [(ngModel)]="Message"
                            [modules]="modules" (onSelectionChanged)="focusFunction($event)"
                            (ngModelChange)="saverange($event)" name="messageContent" (paste)="onPaste($event)">



                        </quill-editor>


                    </form>


                    <div style="display: flex;">





                        <button *ngIf="isGroup" mat-icon-button [matMenuTriggerFor]="menu2"
                            aria-label="Example icon-button with a menu">
                            <mat-icon style="font-size: 25px !important;color:#78787b ;">more_vert</mat-icon>
                        </button>
                        <mat-menu #menu2="matMenu">
                            <button (click)="CreatedVote()" mat-menu-item>
                                <mat-icon>signal_cellular_alt</mat-icon>
                                <span>Tạo bình chọn</span>
                            </button>


                        </mat-menu>
                        <button matTooltip="Icon" mat-icon-button type="button" (click)="Collapsedsticker()"
                            [attr.aria-expanded]="!isCollapsedsticker" aria-controls="collapseBasic">
                            <mat-icon style="font-size: 25px !important;color:#78787b ;">tag_faces</mat-icon>
                        </button>

                        <button style="color:#78787b !important;" (click)="hiddenfileinput_image.click()"
                            matTooltip="Hỉnh ảnh" mat-icon-button aria-label="Example icon button with a home icon">
                            <i style="font-size: 22px;color:#78787b" class="fa fa-file-image-o" aria-hidden="true"></i>
                        </button>
                        <button style="color:#78787b !important;" (click)="hiddenfileinput.click()" matTooltip="File"
                            mat-icon-button aria-label="Example icon button with a home icon">
                            <i style="font-size: 22px;color:#78787b" class="fa fa-paperclip" aria-hidden="true"></i>
                        </button>
                        <!-- videos -->
                        <button style="color:#78787b !important ;" (click)="hiddenfileinput_video.click()"
                            matTooltip="Videos" mat-icon-button aria-label="Example icon button with a home icon">
                            <i style="font-size: 22px;color:#78787b" class="fa fa-file-video-o" aria-hidden="true"></i>
                        </button>
                        <!-- <input type='file' accept="video/mp4,video/x-m4v,video/*" id="PDFInpdd" #hiddenfileinput_video
                  (change)="onSelectVideo($event)" style="display: none;"> -->
                        <input type='file' accept="video/mp4,video/x-m4v,video/*" id="PDFInpdd" #hiddenfileinput_video
                            (change)="onSelectFile_PDF($event)" style="display: none;">

                        <input type='file' accept=".jpg, .png, .jpeg, .gif, .bmp, .tif, .heic, .heif, .tiff|image/*"
                            id="PDFInpdd" #hiddenfileinput_image (change)="onSelectFile_PDF($event)" multiple
                            style="display: none;">

                        <input
                            accept="application/vnd.ms-excel, application/vnd.ms-powerpoint,
            text/plain, application/pdf,application/msword,.pdf, .xls, .xlsx, application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.zip,.rar,.7zip"
                            type='file' id="PDFInpdd" #hiddenfileinput (change)="onSelectFile_PDF($event)" multiple
                            style="display: none;">

                    </div>
                    <!--  begin phần icon -->
                    <!-- <button [matMenuTriggerFor]="menu1"  matTooltip="Icon" (click)="showPT()" mat-icon-button
  aria-label="Example icon button with a home icon">
  <mat-icon style="font-size: 25px !important;color:#78787b ;">tag_faces</mat-icon>
  </button>

    <mat-menu  #menu1="matMenu">
      <span (click)="$event.stopPropagation(); false;">
          <emoji-mart class="emoji-mart" set="{{set}}" (emojiSelect)="addEmoji($event)" title="Pick your emoji…"></emoji-mart>
      </span>
    </mat-menu> -->

                    <!--  begin phần icon -->

                    <!-- <div *ngIf="CheckRoleByKey('status')" style="float: right;margin-right:5px 5px 0 0 ;width: 100px;">

                        <mat-form-field class="example-full-width" style="width: 100px;">
                            <mat-select (selectionChange)="ChangeStage($event.value)" [value]="ticketPcDTO.Status.RowID"
                                #singleSelect>
                                <mat-option *ngFor="let item of this.stautsDTO" [value]="item.RowID">
                                    {{ item.Title }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>

                    </div> -->

                    <button (click)="sendMessageTicket()" style="color:#78787b ;" matTooltip="Gửi tin nhắn"
                        mat-icon-button aria-label="Example icon button with a home icon">
                        <mat-icon>send</mat-icon>
                    </button>



                </div>




            </div>
        </div>
    </div>
</ng-template>
<ng-template #tabchitiet>
    <div *ngIf="ticketPcDTO">
        <div class="row  align-items-center" style="padding-left: 15px !important;padding-right: 10px !important">
            <table class="page-chitiet" style="width: 100%;padding: 0px !important;">
                <tr class="card-bd" style="height: 40px; padding-left: 15px !important;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Phân loại</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div style="padding-right:5px;">
                            <span class="item-detail-ct" style="font-weight: 700;"
                                *ngFor="let cate of this.ticketPcDTO.Category">
                                {{cate.Title}}
                            </span>
                        </div>
                    </td>
                </tr>
                <tr class="card-bd" style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Trả lời gần nhất</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div style="padding-right:5px;">
                            <span class="item-detail-ct" style="font-weight: 500;">
                                {{this.FormatTimeService.format_convertDate(this.ticketPcDTO.LatestReplyTime,1,true)}}
                            </span>
                        </div>
                    </td>
                </tr>
                <tr class="card-bd" style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Trạng thái</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div *ngIf="IdStatus_Dahuyyeucau != this.ticketPcDTO.Status.RowID && (this.CheckRoleByKey('status'));else Dahuy1"
                            class=" background-status" style="padding-right:5px;" [matMenuTriggerFor]="status">
                            <span [ngStyle]="{'background-color': this.ticketPcDTO.Status.Color}"
                                style="color: white;font-size: 10pt;"
                                class="background-status">{{this.ticketPcDTO.Status.Title}}
                            </span>
                        </div>
                        <ng-template #Dahuy1>
                            <div class=" background-status" style="padding-right:5px;">
                                <span [ngStyle]="{'background-color': this.ticketPcDTO.Status.Color}"
                                    style="color: white;font-size: 10pt;"
                                    class="background-status">{{this.ticketPcDTO.Status.Title}}
                                </span>
                            </div>
                        </ng-template>
                    </td>
                    <mat-menu #status="matMenu" style="max-height: 50px;min-width: 160px;">
                        <button mat-menu-item *ngFor="let item of this.stautsDTO" (click)="update_status(item.RowID)">
                            <div style="float: left; padding-top: 15px;">
                                <span class="color-picker" [ngStyle]="{'background-color': item.Color}"></span>


                            </div>
                            <div style="float: right;">
                                {{ item.Title}}

                            </div>
                        </button>
                    </mat-menu>
                </tr>
                <tr class="card-bd" style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Độ ưu tiên</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div class="action" style="padding-right:5px;">

                            <img *ngIf="IdStatus_Dahuyyeucau != this.ticketPcDTO.Status.RowID && (this.CheckRoleByKey('priority'));else Dahuy2"
                                [matMenuTriggerFor]="flag" style="height: 18px;"
                                [ngClass]="get_flag_color(this.ticketPcDTO.Priority)" />
                            <ng-template #Dahuy2>
                                <img style="height: 18px;" [ngClass]="get_flag_color(this.ticketPcDTO.Priority)" />
                            </ng-template>

                            <mat-menu #flag="matMenu" style="max-height: 50px;">
                                <button mat-menu-item *ngFor="let priority of ListPriority"
                                    (click)="update_priority(priority.id)">

                                    <img style="height: 18px;" [ngClass]="get_flag_color(priority.id)" />
                                    {{priority. name}}
                                </button>
                            </mat-menu>
                        </div>
                    </td>
                </tr>
                <tr class="card-bd" style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Nguồn</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div class="action" style="padding-right:2px;float: right;">
                            <ngx-avatar [size]="30" matTooltip="{{this.ticketPcDTO.User.fullname}}"
                                src="{{this.ticketPcDTO.User.image}}"
                                *ngIf="this.ticketPcDTO.User.image;else bindText2">
                            </ngx-avatar>
                            <ng-template #bindText2>
                                <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{this.ticketPcDTO.User.fullname}}"
                                    [size]="30" [name]="getName(this.ticketPcDTO.User.fullname)"
                                    bgColor="{{getColorNameUser(this.ticketPcDTO.User.fullname)}}">
                                </ngx-avatar>
                            </ng-template>
                        </div>
                    </td>
                </tr>
                <tr class="card-bd" style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Theo dõi</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div class="action" style="float: right;">
                            <div class="row row-class item-users">
                                <div *ngIf="IdStatus_Dahuyyeucau != this.ticketPcDTO.Status.RowID && ((this.ticketPcDTO.User.userid != this.user_login || IsAdmin(this.user_login)) || IsAdmin(this.user_login))
                                    ;else Dahuy3" class="show-more-people">
                                    <div style="flex-grow: 1;">
                                        <ng-container *ngFor="let us of this.ticketPcDTO.Follower;let index = index">
                                            <div *ngIf="index < 10" class="user url scale-hover-02 position-relative"
                                                style="justify-content: flex-end;">
                                                <i class="far fa-times-circle url view-hover bg-white"
                                                    style="position: absolute;top:0;right:0;border-radius: 50%;font-size: 8pt;"
                                                    (click)="DeletedEmployee(us)"></i>
                                                <ng-container>
                                                    <ngx-avatar [size]="25" matTooltip="{{us.fullname}}"
                                                        src="{{us.image}}" *ngIf="us.image;else bindText2">
                                                    </ngx-avatar>
                                                    <ng-template #bindText2>
                                                        <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{us.fullname}}"
                                                            [size]="25" [name]="getName(us.fullname)"
                                                            bgColor="{{getColorNameUser(us.fullname)}}">
                                                        </ngx-avatar>
                                                    </ng-template>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                        <ng-container
                                            *ngIf="this.ticketPcDTO.Follower && this.ticketPcDTO.Follower.length > 10">
                                            <div class="m--img-rounded m--marginless m--img-centered background"
                                                [matMenuTriggerFor]="menu1" [ngStyle]="{'width.px': 25,'height.px':25}">
                                                <div class="user w-100 h-100"
                                                    style="opacity: 1;color:white;padding-top:3px;text-align: center;background: grey;"
                                                    [ngStyle]="{'font-size.px': 16}">
                                                    +{{this.ticketPcDTO.Follower.length-10}}
                                                </div>
                                            </div>
                                            <mat-menu #menu1="matMenu">
                                                <div *ngFor="let us of this.ticketPcDTO.Follower;let index = index"
                                                    style="justify-content: flex-end;">
                                                    <ng-container *ngIf="index > 9">
                                                        <div class="position-relative">
                                                            <i class="fas fa-times scale-hover-01 url"
                                                                style="position: absolute;top:0;right:0"
                                                                (click)="DeletedEmployee(us)"></i>
                                                            <div class="row">
                                                                <ngx-avatar [size]="25" matTooltip="{{us.fullname}}"
                                                                    src="{{us.image}}" *ngIf="us.image;else bindText2">
                                                                </ngx-avatar>
                                                                <ng-template #bindText2>
                                                                    <ngx-avatar [textSizeRatio]="2.5"
                                                                        matTooltip="{{us.fullname}}" [size]="25"
                                                                        [name]="getName(us.fullname)"
                                                                        bgColor="{{getColorNameUser(us.fullname)}}">
                                                                    </ngx-avatar>
                                                                </ng-template>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                            </mat-menu>
                                        </ng-container>
                                        <div matTooltip="Chọn người" matTooltipPosition="above" class="url user"
                                            [matMenuTriggerFor]="member"
                                            style="border: 1px dashed #676363;border-radius: 50%;padding: 5px;display: inline-block;width: 25px;height: 25px; ">
                                            <span class="material-icons"
                                                style="float: right;font-size: 16px !important;padding-left: 5px;">
                                                person_add
                                            </span>
                                        </div>
                                    </div>
                                    <mat-menu #member="matMenu">
                                        <div class="page-work-detail" style="width: 359px;">
                                            <kt-choose-users [isNewView]="true" [options]="options"
                                                (IsSearch)="stopPropagation($event)"
                                                (ItemSelected)="SelectedFollower                ($event)">
                                            </kt-choose-users>
                                        </div>
                                    </mat-menu>




                                </div>
                                <ng-template #Dahuy3>
                                    <div class="show-more-people">
                                        <div class="user url"
                                            *ngFor="let us of this.ticketPcDTO.Follower;let index = index"
                                            style="justify-content: flex-end;">
                                            <ng-container *ngIf="index < 3">
                                                <ngx-avatar [size]="25" [matMenuTriggerFor]="menu"
                                                    matTooltip="{{us.fullname}}" src="{{us.image}}"
                                                    *ngIf="us.image;else bindText">
                                                </ngx-avatar>
                                                <ng-template #bindText>
                                                    <ngx-avatar [textSizeRatio]="2.5" [matMenuTriggerFor]="menu"
                                                        matTooltip="{{us.fullname}}" [size]="25"
                                                        [name]="getName(us.fullname)"
                                                        bgColor="{{getColorNameUser(us.fullname)}}">
                                                    </ngx-avatar>
                                                </ng-template>
                                                <mat-menu #menu="matMenu">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <ngx-avatar [size]="50" matTooltip="{{us.fullname}}"
                                                                src="{{us.image}}" *ngIf="us.image;else bindText1">
                                                            </ngx-avatar>
                                                            <ng-template #bindText1>
                                                                <ngx-avatar [textSizeRatio]="2.5"
                                                                    matTooltip="{{us.fullname}}" [size]="50"
                                                                    [name]="getName(us.fullname)"
                                                                    bgColor="{{getColorNameUser(us.fullname)}}">
                                                                </ngx-avatar>
                                                            </ng-template>
                                                        </div>
                                                        <div class="col-md-9 font-chu">
                                                            <div class="col-md-12" style="font-weight: bold;">
                                                                <span>{{us.fullname}}</span>
                                                            </div>
                                                            <div class="col-md-12"><span>@{{us.username}}</span></div>
                                                        </div>
                                                    </div>
                                                </mat-menu>
                                            </ng-container>
                                        </div>
                                        <div class="user url" *ngIf="this.ticketPcDTO.Follower.length > 3"
                                            style="justify-content: flex-end;">
                                            <div class="m--img-rounded m--marginless m--img-centered background"
                                                [matMenuTriggerFor]="menu1" style="width: 25px; height: 25px;">
                                                <div
                                                    style="opacity: 1;color:white;padding-top:3px;text-align: center;    font-size: 14px;">
                                                    +{{this.ticketPcDTO.Follower.length-3}}
                                                </div>
                                            </div>
                                            <mat-menu #menu1="matMenu">
                                                <div *ngFor="let us of this.ticketPcDTO.Follower;let index = index"
                                                    style="justify-content: flex-end;">
                                                    <ng-container *ngIf="index > 2">
                                                        <div class="row ">
                                                            <div class="col-md-3 m--margin-bottom-10-mobile"
                                                                style="padding-left: 5px;">
                                                                <div class="user url" style="margin: 0 0 0 3px;">
                                                                    <ngx-avatar [size]="35" matTooltip="{{us.fullname}}"
                                                                        src="{{us.image}}"
                                                                        *ngIf="us.image;else bindText2">
                                                                    </ngx-avatar>
                                                                    <ng-template #bindText2>
                                                                        <ngx-avatar [textSizeRatio]="2.5"
                                                                            matTooltip="{{us.fullname}}" [size]="35"
                                                                            [name]="getName(us.fullname)"
                                                                            bgColor="{{getColorNameUser(us.fullname)}}">
                                                                        </ngx-avatar>
                                                                    </ng-template>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-9 m--margin-bottom-10-mobile">
                                                                <div class="text-dark"><b>{{us.fullname}} </b></div>
                                                                <div>@{{us.username}}</div>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                            </mat-menu>
                                        </div>






                                    </div>
                                </ng-template>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr style="height: 40px;">
                    <td style="width: 35%;">
                        <div class="title">
                            <span class="item-title-ct">Người hỗ trợ</span>
                        </div>
                    </td>
                    <td style="width: 65%;text-align: end;">
                        <div class="action" style="float: right;">
                            <div class="row row-class item-users">
                                <div *ngIf="IdStatus_Dahuyyeucau != this.ticketPcDTO.Status.RowID && (this.ticketPcDTO.User.userid != this.user_login || IsAdmin(this.user_login));else Dahuy7"
                                    class="show-more-people">
                                    <div style="flex-grow: 1;">
                                        <ng-container *ngFor="let us of this.ticketPcDTO.Agent;let index = index">
                                            <div *ngIf="index < 10" class="user url scale-hover-02 position-relative"
                                                style="justify-content: flex-end;">
                                                <i class="far fa-times-circle url view-hover bg-white"
                                                    style="position: absolute;top:0;right:0;border-radius: 50%;font-size: 8pt;"
                                                    (click)="UpdateAgent(us)"></i>
                                                <ng-container>
                                                    <ngx-avatar [size]="25" matTooltip="{{us.fullname}}"
                                                        src="{{us.image}}" *ngIf="us.image;else bindText2">
                                                    </ngx-avatar>
                                                    <ng-template #bindText2>
                                                        <ngx-avatar [textSizeRatio]="2.5" matTooltip="{{us.fullname}}"
                                                            [size]="25" [name]="getName(us.fullname)"
                                                            bgColor="{{getColorNameUser(us.fullname)}}">
                                                        </ngx-avatar>
                                                    </ng-template>
                                                </ng-container>
                                            </div>
                                        </ng-container>
                                        <ng-container
                                            *ngIf="this.ticketPcDTO.Agent && this.ticketPcDTO.Agent.length > 10">
                                            <div class="m--img-rounded m--marginless m--img-centered background"
                                                [matMenuTriggerFor]="menu1" [ngStyle]="{'width.px': 25,'height.px':25}">
                                                <div class="user w-100 h-100"
                                                    style="opacity: 1;color:white;padding-top:3px;text-align: center;background: grey;"
                                                    [ngStyle]="{'font-size.px': 16}">
                                                    +{{this.ticketPcDTO.Agent.length-10}}
                                                </div>
                                            </div>
                                            <mat-menu #menu1="matMenu">
                                                <div *ngFor="let us of this.ticketPcDTO.Agent;let index = index"
                                                    style="justify-content: flex-end;">
                                                    <ng-container *ngIf="index > 9">
                                                        <div class="position-relative">
                                                            <i class="fas fa-times scale-hover-01 url"
                                                                style="position: absolute;top:0;right:0"
                                                                (click)="UpdateAgent(us)"></i>
                                                            <div class="row">
                                                                <ngx-avatar [size]="25" matTooltip="{{us.fullname}}"
                                                                    src="{{us.image}}" *ngIf="us.image;else bindText2">
                                                                </ngx-avatar>
                                                                <ng-template #bindText2>
                                                                    <ngx-avatar [textSizeRatio]="2.5"
                                                                        matTooltip="{{us.fullname}}" [size]="25"
                                                                        [name]="getName(us.fullname)"
                                                                        bgColor="{{getColorNameUser(us.fullname)}}">
                                                                    </ngx-avatar>
                                                                </ng-template>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                            </mat-menu>
                                        </ng-container>
                                        <div matTooltip="Chọn người" matTooltipPosition="above" class="url user"
                                            [matMenuTriggerFor]="member"
                                            style="border: 1px dashed #676363;border-radius: 50%;padding: 5px;display: inline-block;width: 25px;height: 25px; ">
                                            <span class="material-icons"
                                                style="float: right;font-size: 16px !important;padding-left: 5px;">
                                                person_add
                                            </span>
                                        </div>
                                    </div>
                                    <mat-menu #member="matMenu">
                                        <div class="page-work-detail" style="width: 359px;">
                                            <kt-choose-users [isNewView]="true" [options]="options"
                                                (IsSearch)="stopPropagation($event)"
                                                (ItemSelected)="SelectedAgent($event)">
                                            </kt-choose-users>
                                        </div>
                                    </mat-menu>




                                </div>
                                <ng-template #Dahuy7>
                                    <div class="show-more-people">
                                        <div class="user url"
                                            *ngFor="let us of this.ticketPcDTO.Agent;let index = index"
                                            style="justify-content: flex-end;">
                                            <ng-container *ngIf="index < 3">
                                                <ngx-avatar [size]="25" [matMenuTriggerFor]="menu"
                                                    matTooltip="{{us.fullname}}" src="{{us.image}}"
                                                    *ngIf="us.image;else bindText">
                                                </ngx-avatar>
                                                <ng-template #bindText>
                                                    <ngx-avatar [textSizeRatio]="2.5" [matMenuTriggerFor]="menu"
                                                        matTooltip="{{us.fullname}}" [size]="25"
                                                        [name]="getName(us.fullname)"
                                                        bgColor="{{getColorNameUser(us.fullname)}}">
                                                    </ngx-avatar>
                                                </ng-template>
                                                <mat-menu #menu="matMenu">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <ngx-avatar [size]="50" matTooltip="{{us.fullname}}"
                                                                src="{{us.image}}" *ngIf="us.image;else bindText1">
                                                            </ngx-avatar>
                                                            <ng-template #bindText1>
                                                                <ngx-avatar [textSizeRatio]="2.5"
                                                                    matTooltip="{{us.fullname}}" [size]="50"
                                                                    [name]="getName(us.fullname)"
                                                                    bgColor="{{getColorNameUser(us.fullname)}}">
                                                                </ngx-avatar>
                                                            </ng-template>
                                                        </div>
                                                        <div class="col-md-9 font-chu">
                                                            <div class="col-md-12" style="font-weight: bold;">
                                                                <span>{{us.fullname}}</span>
                                                            </div>
                                                            <div class="col-md-12"><span>@{{us.username}}</span></div>
                                                        </div>
                                                    </div>
                                                </mat-menu>
                                            </ng-container>
                                        </div>
                                        <div class="user url" *ngIf="this.ticketPcDTO.Agent.length > 3"
                                            style="justify-content: flex-end;">
                                            <div class="m--img-rounded m--marginless m--img-centered background"
                                                [matMenuTriggerFor]="menu1" style="width: 25px; height: 25px;">
                                                <div
                                                    style="opacity: 1;color:white;padding-top:3px;text-align: center;    font-size: 14px;">
                                                    +{{this.ticketPcDTO.Agent.length-3}}
                                                </div>
                                            </div>
                                            <mat-menu #menu1="matMenu">
                                                <div *ngFor="let us of this.ticketPcDTO.Agent;let index = index"
                                                    style="justify-content: flex-end;">
                                                    <ng-container *ngIf="index > 2">
                                                        <div class="row ">
                                                            <div class="col-md-3 m--margin-bottom-10-mobile"
                                                                style="padding-left: 5px;">
                                                                <div class="user url" style="margin: 0 0 0 3px;">
                                                                    <ngx-avatar [size]="35" matTooltip="{{us.fullname}}"
                                                                        src="{{us.image}}"
                                                                        *ngIf="us.image;else bindText2">
                                                                    </ngx-avatar>
                                                                    <ng-template #bindText2>
                                                                        <ngx-avatar [textSizeRatio]="2.5"
                                                                            matTooltip="{{us.fullname}}" [size]="35"
                                                                            [name]="getName(us.fullname)"
                                                                            bgColor="{{getColorNameUser(us.fullname)}}">
                                                                        </ngx-avatar>
                                                                    </ng-template>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-9 m--margin-bottom-10-mobile">
                                                                <div class="text-dark"><b>{{us.fullname}} </b></div>
                                                                <div>@{{us.username}}</div>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                            </mat-menu>
                                        </div>
                                    </div>
                                </ng-template>
                            </div>
                        </div>
                    </td>
                </tr>




            </table>
        </div>
    </div>

</ng-template>


<ng-template #tabtailieu>
    <div *ngIf="ticketPcDTO">
        <div class="header-body overflow-auto scroller padding-menu-right"
            [ngStyle]="{ 'height': getHeight_tailieu(),'max-height': getmaxHeight_tailieu() }"
            (scroll)="onScroll($event)">
            <div class="example-container mat-table__wrapper" style="overflow: hidden !important;">
                <div *ngFor="let us of this.ticketPcDTO.Document;let vifiledown = index">
                    <div style="width: 100%;">

                        <div class="attachment-row">
                            <div style="width:75%; float: left;">
                                <div class="row" style="text-align:right ;right:0;">
                                    <div class="col-2" style="padding-left: 10px;width: 25px;">
                                        <img src="{{getIcon(us.Type)}}" />

                                    </div>
                                    <div class="col-8" style="text-align: left;font-size: 10pt;">
                                        <p class="HienDauBaCham_Doc name-doc"
                                            style="text-align: left;width: 100%;  word-wrap: break-word;padding-left: 5px;">
                                            {{us.Name}} </p>
                                    </div>
                                </div>

                            </div>

                            <div style="width:25%;padding-right: 10px;float: right;"
                                *ngIf="IdStatus_Dahuyyeucau != status_ticket">
                                <a *ngIf="IdStatus_Dahuyyeucau != this.ticketPcDTO.Status.RowID||IdStatus_Closed != this.ticketPcDTO.Status.RowID || (this.ticketPcDTO.User.userid != this.user_login || IsAdmin(this.user_login))"
                                    style="float: right;right:0" class="url" matTooltip="Xóa"
                                    (click)="deleteTicketDocument(us)">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                                <a style="padding-right: 7px;float: right;" (click)="preview(us)" class="url"
                                    matTooltip="Xem trước">
                                    <i class="far fa-eye"></i>
                                </a>
                                <a *ngIf="!IsImage(us); else downnImage" style="padding-right: 7px;float: right;"
                                (click)="saveOrOpenBlobFileAll(us.Link,us.Name,vifiledown)" class="url" matTooltip="Tải xuống">
                                    <i class="fas fa-download"></i>
                                </a>
                                <ng-template #downnImage>
                                    <a style="padding-right: 7px;float: right;" (click)="TaiXuongAnh(us)" class="url"
                                        matTooltip="Tải xuống">
                                        <i class="fas fa-download"></i>
                                    </a>
                                </ng-template>


                            </div>
                        </div>

                    </div>

                </div>

            </div>


        </div>
    </div>

</ng-template>

<ng-template #tabhoatdong>
    <div *ngIf="ticketPcDTO" class=" row  align-items-center"
        style="padding-left: 15px !important;padding-right: 10px !important;overflow-y: scroll !important;">
        <div [ngStyle]="{ height: getHeight_hoatdong() }">
            <div class="page-chitiet" style="width: 100%;padding: 0px !important;">
                <div class="activity-row" *ngFor="let activity of this.ticketPcDTO.Activity;let index = index"
                    style="height: 50px;">
                    <div>
                        <span class="time-activity">{{(activity.Time) | timeAgoCus}}</span>
                    </div>
                    <div>
                        <div><span class="name-activity">
                                {{activity.fullname}}</span><span class="nd-activity"> 
                                {{activity.ActionText}}</span></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

</ng-template>